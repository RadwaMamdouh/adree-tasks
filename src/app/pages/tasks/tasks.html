<p-toast></p-toast>
<p-confirmpopup />

<div class="d-flex align-items-center justify-content-between gap-3 flex-wrap mbe_20">
  <h1 class="fs_30 fw_700 primary">Tasks</h1>
  <app-button label="Add Task" (onAction)="openNew()" />
</div>

<div class="divHolder">
  @if(tasks.length > 0){<p-table
    [value]="tasks"
    [paginator]="true"
    [rows]="5"
    [scrollable]="true"
    aria-label="Task List"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Assigned To</th>
        <th>Due Date</th>
        <th>Estimated Hours</th>
        <th>Task Category</th>
        <th>Status</th>
        <th alignFrozen="right" pFrozenColumn>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-task>
      <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.description }}</td>
        <td>{{ task.assignedTo }}</td>
        <td>{{ task.dueDate | date : 'shortDate' }}</td>
        <td>{{ task.estimatedHours }}</td>
        <td>{{ task.category }}</td>
        <td>
          <app-badge [label]="task.status" [classes]="getStatusClass(task.status)" />
        </td>
        <td alignFrozen="right" pFrozenColumn>
          <div class="d-flex align-items-center gap-2">
            <p-button
              icon="pi pi-pencil"
              [text]="true"
              (click)="editTask(task)"
              aria-label="Edit Task"
            ></p-button>
            <p-button
              icon="pi pi-trash"
              [text]="true"
              (click)="deleteTask($event, task.id)"
              severity="danger"
              aria-label="Delete Task"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template> </p-table
  >}@else {
  <app-empty-data title="there are not tasks yet" classes="py-5" />
  }
</div>

<p-dialog
  [header]="taskDialogTitle"
  [(visible)]="taskDialog"
  [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '50vw' }"
>
  <form [formGroup]="taskForm" (ngSubmit)="saveTask()">
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Title</label>
      <input pInputText formControlName="title" class="w-100" />
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Description</label>
      <input pInputText formControlName="description" class="w-100" />
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Assigned To</label>
      <input pInputText formControlName="assignedTo" class="w-100" />
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Due Date</label>
      <p-datepicker formControlName="dueDate" class="w-100" [appendTo]="'body'"></p-datepicker>
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Estimated Hours</label>
      <input type="number" pInputText formControlName="estimatedHours" class="w-100" />
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Category</label>
      <p-select
        [options]="categories"
        formControlName="category"
        class="w-100"
        [appendTo]="'body'"
      ></p-select>
    </div>
    <div class="mbe_16">
      <label class="d-block fs_14 fw_500 text-dark mbe_8">Status</label>
      <p-select
        [options]="statuses"
        formControlName="status"
        class="w-100"
        [appendTo]="'body'"
      ></p-select>
    </div>
  </form>
  <ng-template #footer>
    <app-button
      label="Save"
      type="submit"
      [disabled]="taskForm.invalid"
      (onAction)="saveTask()"
    ></app-button>
  </ng-template>
</p-dialog>
